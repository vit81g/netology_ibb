инструменты powerShell
письма составлялись под конкретную команду внутри организации
цель - заражение компьютеров целевого департамента в инфраструктуре организации
практика схожа с redteam (RedOctober и CloudAtlas)

initial Access
Phishing


Инструменты:
PowerShell
1) InitialDropper
2) Dropper


---- Valid Accounts

Злоумышленники могут получить и злоупотребить учетными данными существующих учетных записей в качестве средства получения первоначального доступа, сохранения, повышения привилегий или уклонения от защиты. Скомпрометированные учетные данные могут использоваться для обхода контроля доступа, размещенного на различных ресурсах систем в сети, и даже могут использоваться для постоянного доступа к удаленным системам и внешним службам, таким как VPN, Outlook Web Access, сетевые устройства и удаленный рабочий стол.[ 1] Скомпрометированные учетные данные могут также предоставить злоумышленнику повышенные привилегии для определенных систем или доступ к ограниченным областям сети. Злоумышленники могут отказаться от использования вредоносных программ или инструментов в сочетании с законным доступом, который обеспечивают эти учетные данные, чтобы затруднить обнаружение их присутствия.

В некоторых случаях злоумышленники могут злоупотреблять неактивными учетными записями: например, принадлежащими лицам, которые больше не являются частью организации. Использование этих учетных записей может позволить злоумышленнику избежать обнаружения, поскольку исходный пользователь учетной записи не будет присутствовать для выявления какой-либо аномальной активности, происходящей с его учетной записью.[2]

Перекрытие разрешений для локальных, доменных и облачных учетных записей в сети систем вызывает беспокойство, поскольку злоумышленник может иметь возможность переключаться между учетными записями и системами для достижения высокого уровня доступа (например, администратора домена или предприятия) для обхода доступа. средства контроля, установленные внутри предприятия.[3]


Taint Shared Content +

Злоумышленники могут доставлять полезные данные в удаленные системы, добавляя контент в общие хранилища, такие как сетевые диски или внутренние репозитории кода. Содержимое, хранящееся на сетевых дисках или в других местах общего доступа, может быть испорчено путем добавления вредоносных программ, сценариев или кода эксплойта в действительные файлы. Как только пользователь открывает общий испорченный контент, вредоносная часть может быть запущена для запуска кода злоумышленника в удаленной системе. Злоумышленники могут использовать испорченный общий контент для перемещения в горизонтальном направлении.

Сводка общего доступа к каталогу — это вариант этого метода, который использует несколько других методов для распространения вредоносного ПО при доступе пользователей к общему сетевому каталогу. Он использует быструю модификацию файлов .LNK каталога, которые используют маскировку, чтобы выглядеть как настоящие каталоги, которые скрыты с помощью скрытых файлов и каталогов. Вредоносные каталоги на основе .LNK имеют встроенную команду, которая запускает скрытый файл вредоносного ПО в каталоге, а затем открывает настоящий предполагаемый каталог, чтобы ожидаемое пользователем действие все равно произошло. При использовании с часто используемыми сетевыми каталогами этот метод может привести к частым повторным заражениям и широкому доступу к системам и, возможно, к новым учетным записям с более высокими привилегиями. [1]

Злоумышленники также могут скомпрометировать общие сетевые каталоги посредством заражения двоичными файлами, добавляя или добавляя свой код к работоспособному двоичному файлу в общем сетевом каталоге. Вредоносная программа может изменить исходную точку входа (OEP) работоспособного двоичного файла, чтобы гарантировать, что он будет выполнен раньше легального кода. Инфекция может продолжать распространяться через вновь зараженный файл, когда он выполняется удаленной системой. Эти инфекции могут быть нацелены как на двоичные, так и на недвоичные форматы, которые заканчиваются расширениями, включая, помимо прочего, .EXE, .DLL, .SCR, .BAT и/или .VBS.

User Execution +

Злоумышленник может полагаться на определенные действия пользователя, чтобы добиться выполнения. Пользователи могут быть подвергнуты социальной инженерии, чтобы заставить их выполнить вредоносный код, например, открыв файл или ссылку вредоносного документа. Эти действия пользователя обычно рассматриваются как продолжение фишинга.

Хотя выполнение пользователя часто происходит вскоре после первоначального доступа, оно может произойти и на других этапах вторжения, например, когда злоумышленник помещает файл в общий каталог или на рабочий стол пользователя в надежде, что пользователь щелкнет по нему. Эту активность также можно увидеть вскоре после внутреннего целевого фишинга.

Злоумышленники также могут обманным путем заставить пользователей выполнять такие действия, как включение программного обеспечения удаленного доступа, предоставление злоумышленнику прямого контроля над системой или загрузка и запуск вредоносного ПО для выполнения пользователем. Например, мошенничество с технической поддержкой может осуществляться посредством фишинга, вишинга или различных форм взаимодействия с пользователем. Злоумышленники могут использовать комбинацию этих методов, например подделку и продвижение бесплатных номеров или колл-центров, которые используются для направления жертв на вредоносные веб-сайты, для доставки и выполнения полезных данных, содержащих вредоносное ПО или программное обеспечение для удаленного доступа.[1]


Network Share Discovery +

Злоумышленники могут искать папки и диски, общие для удаленных систем, в качестве средства идентификации источников информации, которую необходимо собрать в качестве предшественника для сбора, а также для выявления потенциальных систем, представляющих интерес для латерального перемещения. Сети часто содержат общие сетевые диски и папки, которые позволяют пользователям получать доступ к каталогам файлов в различных системах в сети.

Общий доступ к файлам в сети Windows осуществляется по протоколу SMB. [1] [2] Net можно использовать для запроса удаленной системы на наличие доступных общих дисков с помощью команды net view \\remotesystem. Его также можно использовать для запроса общих дисков в локальной системе с использованием netshare. В macOS командаshare -l выводит список всех общих точек, используемых для служб smb.


---- Software Deployment Tools  


---- Exploitation of Remote Services


---- Application Layer Protocol



??-- System Network Connections Discovery

Злоумышленники могут попытаться получить список сетевых подключений к или от скомпрометированной системы, к которой они в данный момент обращаются, или от удаленных систем, запрашивая информацию по сети.

Злоумышленник, получивший доступ к системе, являющейся частью облачной среды, может составить карту виртуальных частных облаков или виртуальных сетей, чтобы определить, какие системы и службы подключены. Выполняемые действия, скорее всего, представляют собой одни и те же методы обнаружения в зависимости от операционной системы, но полученная информация может включать подробную информацию о сетевой облачной среде, соответствующую целям злоумышленника. Поставщики облачных услуг могут использовать разные способы работы своих виртуальных сетей.[1][2][3] Аналогично, злоумышленники, получившие доступ к сетевым устройствам, могут также выполнять аналогичные действия по обнаружению для сбора информации о подключенных системах и службах.

Утилиты и команды, которые получают эту информацию, включают netstat, «net use» и «net session» с Net. В Mac и Linux netstat и lsof можно использовать для просмотра текущих подключений. who -a и w можно использовать, чтобы показать, какие пользователи в данный момент вошли в систему, аналогично «сетевому сеансу». Кроме того, можно использовать встроенные функции сетевых устройств и CLI сетевых устройств (например, показать IP-сокеты, показать tcp Brief).[4]



??-- Drive-by Compromise

Злоумышленники могут получить доступ к системе через посещение пользователем веб-сайта в ходе обычного просмотра. При использовании этого метода веб-браузер пользователя обычно подвергается атаке, но злоумышленники также могут использовать взломанные веб-сайты для действий, не связанных с эксплуатацией, например для получения токена доступа к приложению.

Существует несколько способов доставки кода эксплойта в браузер (например, Drive-by Target), в том числе:

     Законный веб-сайт подвергается риску, когда злоумышленники внедрили ту или иную форму вредоносного кода, такого как JavaScript, iFrames и межсайтовый скриптинг.
     Файлы сценариев, передаваемые на законный веб-сайт из общедоступного облачного хранилища, модифицируются злоумышленником.
     Вредоносная реклама оплачивается и обслуживается законными поставщиками рекламы (т. е. вредоносной рекламой).
     Встроенные интерфейсы веб-приложений используются для вставки объектов любого другого типа, которые можно использовать для отображения веб-контента или содержать сценарий, исполняемый на посещающем клиенте (например, сообщения на форуме, комментарии и другой веб-контент, управляемый пользователем).

Зачастую веб-сайт, используемый злоумышленником, посещается определенным сообществом, например правительством, определенной отраслью или регионом, где целью является скомпрометировать конкретного пользователя или группу пользователей на основе общих интересов. Такую целевую кампанию часто называют стратегическим веб-компрометированием или атакой на водопой. Есть несколько известных примеров этого.[1]

Типичный процесс компрометации:

     Пользователь посещает веб-сайт, который используется для размещения контента, контролируемого злоумышленником.
     Скрипты выполняются автоматически, обычно выполняя поиск потенциально уязвимой версии браузера и плагинов.
         Пользователю может потребоваться помощь в этом процессе, включив сценарии или активные компоненты веб-сайта и игнорируя диалоговые окна с предупреждениями.
     При обнаружении уязвимой версии код эксплойта доставляется в браузер.
     Если эксплуатация окажется успешной, то она приведет к выполнению кода злоумышленника в системе пользователя, если не будут установлены другие средства защиты.
         В некоторых случаях перед доставкой кода эксплойта требуется второе посещение веб-сайта после первоначального сканирования.

В отличие от Exploit Public-Facing Application, этот метод направлен на использование программного обеспечения на конечной точке клиента при посещении веб-сайта. Обычно это дает злоумышленнику доступ к системам во внутренней сети, а не к внешним системам, которые могут находиться в демилитаризованной зоне.

Злоумышленники также могут использовать взломанные веб-сайты, чтобы направить пользователя к вредоносному приложению, предназначенному для кражи токенов доступа к приложениям, например токенов OAuth, для получения доступа к защищенным приложениям и информации. Эти вредоносные приложения доставлялись через всплывающие окна на законных веб-сайтах.[2]


Boot or Logon Initialization Scripts +

Злоумышленники могут использовать сценарии, автоматически выполняемые при загрузке или инициализации входа в систему, чтобы обеспечить постоянство. Сценарии инициализации можно использовать для выполнения административных функций, которые часто могут выполнять другие программы или отправлять информацию на внутренний сервер журналирования. Эти сценарии могут различаться в зависимости от операционной системы и от того, применяются ли они локально или удаленно.

Злоумышленники могут использовать эти сценарии для поддержания устойчивости в одной системе. В зависимости от конфигурации доступа сценариев входа в систему могут потребоваться либо локальные учетные данные, либо учетная запись администратора.

Злоумышленник также может иметь возможность повысить свои привилегии, поскольку некоторые сценарии инициализации загрузки или входа в систему выполняются с более высокими привилегиями.


--- Remote Access Software



File and Directory Discovery

Злоумышленники могут перечислять файлы и каталоги или искать в определенных местах хоста или сетевого ресурса определенную информацию в файловой системе. Злоумышленники могут использовать информацию, полученную при обнаружении файлов и каталогов во время автоматического обнаружения, для формирования последующего поведения, включая определение того, полностью ли злоумышленник заражает цель и/или пытается выполнить определенные действия.

Для получения этой информации можно использовать множество утилит командной оболочки. Примеры: dir, Tree, ls, find иlocate.[1] Пользовательские инструменты также могут использоваться для сбора информации о файлах и каталогах и взаимодействия с Native API. Злоумышленники также могут использовать CLI сетевого устройства на сетевых устройствах для сбора информации о файлах и каталогах (например, dir, show flash и/или nvram).[2]



System Owner/User Discovery +

Злоумышленники могут попытаться идентифицировать основного пользователя, пользователя, вошедшего в систему в данный момент, группы пользователей, которые обычно используют систему, или того, активно ли пользователь использует систему. Они могут сделать это, например, получив имена пользователей учетных записей или используя сброс учетных данных ОС. Информация может быть собрана различными способами с использованием других методов обнаружения, поскольку сведения о пользователе и имени пользователя преобладают во всей системе и включают владение запущенным процессом, владение файлом/каталогом, информацию о сеансе и системные журналы. Злоумышленники могут использовать информацию, полученную от обнаружения владельца/пользователя системы во время автоматического обнаружения, для формирования последующего поведения, в том числе того, полностью ли злоумышленник заражает цель и/или пытается выполнить определенные действия.

Эту информацию могут получать различные утилиты и команды, в том числе whoami. В macOS и Linux текущий вошедший в систему пользователь может быть идентифицирован с помощью w и who. В macOS файл dscl. список /Пользователи | Команда grep -v '_' также может использоваться для перечисления учетных записей пользователей. Переменные среды, такие как %USERNAME% и $USER, также могут использоваться для доступа к этой информации.

На сетевых устройствах команды CLI сетевого устройства, такие как showusers и show ssh, могут использоваться для отображения пользователей, вошедших в данный момент в устройство.[1][2]


??-- Remote Services

Злоумышленники могут использовать действительные учетные записи для входа в службу, которая принимает удаленные подключения, такие как telnet, SSH и VNC. Затем злоумышленник может выполнять действия от имени вошедшего в систему пользователя.

В корпоративной среде серверы и рабочие станции могут быть организованы в домены. Домены обеспечивают централизованное управление идентификацией, позволяя пользователям входить в систему, используя один набор учетных данных во всей сети. Если злоумышленник сможет получить набор действительных учетных данных домена, он сможет войти на множество разных компьютеров, используя протоколы удаленного доступа, такие как безопасная оболочка (SSH) или протокол удаленного рабочего стола (RDP).[1][2] Они также могут войти в доступные службы SaaS или IaaS, например те, которые объединяют их идентификационные данные с доменом.

Законные приложения (такие как инструменты развертывания программного обеспечения и другие административные программы) могут использовать удаленные службы для доступа к удаленным хостам. Например, Apple Remote Desktop (ARD) в macOS — это встроенное программное обеспечение, используемое для удаленного управления. ARD использует сочетание протоколов, включая VNC для отправки буферов экрана и управления, а также SSH для безопасной передачи файлов.[3][4][5] Злоумышленники могут злоупотреблять такими приложениями, как ARD, для удаленного выполнения кода и бокового перемещения. В версиях macOS до 10.14 злоумышленник может перевести сеанс SSH в сеанс ARD, что позволяет злоумышленнику принимать запросы TCC (прозрачность, согласие и контроль) без взаимодействия с пользователем и получать доступ к данным.[6][7] [4]




Command and Scripting Interpreter +

Злоумышленники могут злоупотреблять интерпретаторами команд и сценариев для выполнения команд, сценариев или двоичных файлов. Эти интерфейсы и языки обеспечивают способы взаимодействия с компьютерными системами и являются общей особенностью многих различных платформ. Большинство систем имеют встроенный интерфейс командной строки и возможности создания сценариев, например, дистрибутивы macOS и Linux включают в себя некоторую разновидность Unix Shell, а установки Windows включают командную оболочку Windows и PowerShell.

Существуют также кросс-платформенные интерпретаторы, такие как Python, а также те, которые обычно связаны с клиентскими приложениями, такими как JavaScript и Visual Basic.

Злоумышленники могут различными способами злоупотреблять этими технологиями как средством выполнения произвольных команд. Команды и сценарии могут быть встроены в полезные данные начального доступа, доставляемые жертвам в виде документов-приманок, или как вторичные полезные данные, загруженные из существующего C2. Злоумышленники также могут выполнять команды через интерактивные терминалы/оболочки, а также использовать различные удаленные службы для удаленного выполнения.[1][2][3]


Account Discovery +

Злоумышленники могут попытаться получить список действительных учетных записей, имен пользователей или адресов электронной почты в системе или в скомпрометированной среде. Эта информация может помочь злоумышленникам определить, какие учетные записи существуют, что может помочь в последующих действиях, таких как перебор, целевые фишинговые атаки или захват учетных записей (например, действительные учетные записи).

Злоумышленники могут использовать несколько методов для перебора учетных записей, включая злоупотребление существующими инструментами, встроенными командами и потенциальные неправильные настройки, которые приводят к утечке имен учетных записей, их ролей или разрешений в целевой среде.

Например, облачные среды обычно предоставляют легкодоступные интерфейсы для получения списков пользователей. На хостах злоумышленники могут использовать PowerShell по умолчанию и другие функции командной строки для идентификации учетных записей. Информация об адресах электронной почты и учетных записях также может быть получена путем поиска файлов зараженной системы.


System Information Discovery +

An adversary may attempt to get detailed information about the operating system and hardware, including version, patches, hotfixes, service packs, and architecture. Adversaries may use the information from System Information Discovery during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.

Tools such as Systeminfo can be used to gather detailed system information. If running with privileged access, a breakdown of system data can be gathered through the systemsetup configuration tool on macOS. As an example, adversaries with user-level access can execute the df -aH command to obtain currently mounted disks and associated freely available space. Adversaries may also leverage a Network Device CLI on network devices to gather detailed system information (e.g. show version).[1] System Information Discovery combined with information gathered from other forms of discovery and reconnaissance can drive payload development and concealment.[2][3]

Infrastructure as a Service (IaaS) cloud providers such as AWS, GCP, and Azure allow access to instance and virtual machine information via APIs. Successful authenticated API calls can return data such as the operating system platform and status of a particular instance or the model view of a virtual machine.[4][5][6]



Boot or Logon Autostart Execution +

Злоумышленники могут настроить параметры системы для автоматического выполнения программы во время загрузки системы или входа в систему, чтобы сохранить постоянство или получить привилегии более высокого уровня в скомпрометированных системах. Операционные системы могут иметь механизмы для автоматического запуска программы при загрузке системы или входе в учетную запись.[1][2][3][4][5] Эти механизмы могут включать в себя автоматически выполняемые программы, которые размещаются в специально отведенных каталогах или на которые ссылаются репозитории, в которых хранится информация о конфигурации, например реестр Windows. Злоумышленник может достичь той же цели, изменив или расширив возможности ядра.

Поскольку некоторые программы автозапуска загрузки или входа в систему запускаются с более высокими привилегиями, злоумышленник может использовать их для повышения привилегий.


Scheduled Task/Job  +

Злоумышленники могут злоупотреблять функцией планирования задач, чтобы облегчить первоначальное или повторное выполнение вредоносного кода. Во всех основных операционных системах существуют утилиты для планирования выполнения программ или сценариев в определенную дату и время. Задачу также можно запланировать в удаленной системе при условии соблюдения надлежащей аутентификации (например, RPC и общий доступ к файлам и принтерам в средах Windows). Для планирования задачи в удаленной системе обычно может потребоваться членство в администраторской или иной привилегированной группе в удаленной системе.[1]

Злоумышленники могут использовать планирование задач для запуска программ при запуске системы или по расписанию для обеспечения устойчивости. Этими механизмами также можно злоупотреблять для запуска процесса в контексте указанной учетной записи (например, с повышенными разрешениями/привилегиями). Подобно системному двоичному прокси-выполнению, злоумышленники также злоупотребляют планированием задач, чтобы потенциально замаскировать однократное выполнение под доверенным системным процессом.[2]























Web Service
