Matrix for enterprise: как пользоваться?
1. Основной способ - искать различные процедуры для определенной техники и
пытаться понять, как можно детектировать использование этой техники
- некоторые техники нельзя детектировать однозначно (похожи на легетимную активность)
- некоторые техники бесполезно детектировать (слишком шумные, часто используются
пользователями)
- некоторые техники можно детектировать только с использованием специальных
средств (дополнительное логирование)
2. Дополнительный способ - выбрать определенного атакующего и рассматривать и
искать техники, присущие только этому атакующему (т.е. предполагается, что именно
этот атакующий проник в сеть)

Пример :
Можно искать в матрице MITRE ATT&CK по определенным хакермким группам
APT18 - перечислены использующиеся техники и процедуры
Использует валидные аккаунты для получения доступа

MITRE ATT&CK Navigator - альтернотивое отображение техник хакурских групп
Синим подсвечены техники которые использует группировка
APT18 - 10 техник используют

Есть Топ-20 техник, они представлены практически у всех APT
Мониторин процессов, с какими правами запускались, с какими аргументами запускались

Процесс TH  :                 Внутренняя БД        Гипотеза 1    Сеть организации
MITRE ATT&CK                  Внутренняя БД        Гипотеза 2    Сеть организации
Коммерчиские данные           Внутренняя БД        Гипотеза 3    Сеть организации
Публичные отчеты              Внутренняя БД        Гипотеза 4    Сеть организации
Внутренние расследования      Внутренняя БД        Гипотеза 5    Сеть организации
Предыдущие "ханты"            Внутренняя БД        Гипотеза n-1  Сеть организации
Прочее                        Внутренняя БД        Гипотеза n    Сеть организации

TH очень зависит от людей, опыта

Внутренняя база знаний, верхняя часть и нижняя:
Верхняя часть содержит:
1. Атрибуция, 2. Цели, 3. Актуальность, 4. Кампании, 5 Тактики, 6. Техники,
7. Процедуры, 8. Инструменты
Нижняя часть содержит:
1. Плейбуки (содержит инструкции, описания, что надо делать при обнаружении
групировки в сети, какие логи вести),  2. Хеши, 3. IP-адреса, 4. Доменные имена,
5. Имена файлов, 6. Имена ключей реестра, 7. Уникальные номера портов, 8. Etc

Реализация TH:
1. Создать базу знаний
2. Настроить логирование
Далее переходим к циклу TH:
3. Создать гипотезу, начать поиск, найти следы активного инцидента

Источники логирования:
1. Все источники логов можно разделить на две группы: хостовые и сетевые
2. Сетевые логи позволяют искать только следы техник, связанных с сетевыми
взаимодействиями
3. Хостовые логи позволяют искать следы всех техник
4. Основная идея TH - производить поиск среди событий из хостовых логов, при этом
дополнительно обогащая их событиями из сетевых логов (при необходимости)
5. Возможность использовать различные средства логирования зависит от многих
факторов (основных два - бюджет и умение работы с источником)
6. Необходимость поддерживать актуальность средств и оперативно узнавать о новых
(возможно, более приемлимых) средствах логирования

Можно смотреть MITRE ATT&CK, что бы узнать что необходимо логировать для техники
выбираем технику, далее Date Sources - покажет что необходимо логировать
Пример - логирование в ОС Windows процесса cmd.exe
Логируем Command: Command Execution, Process: Process Creation позволит логировать
какие процессы запускались и какие параметры процессов передавались

MITRE ATT&CK -> Data sources - хостовые источники
отоброзит хостовые источники, логирование
Наиболее важные:
Process monitoring (какие процессы запущены, от имени каких пользователей, когда,
 с правами)
Process command-line parameters (какие параметры при запуске процесса были переданы)
File monitoring
Process use of network (работа с сетью)
Windows event logs
Windows registry (взаимодействие с реестром)
Мониторинг дополнительных журналов:
DLL monitoring
PowerShell Logs

Не мониторим все, выбираем определенный набор и смотрим
Обращаем на процессы которые активно ведут сетевое соединение с внешними IP и
передаю данные
Обогащаем netflow данными IP, сколько байт было передано за сейнс на этот IP

Необходимо знать какие тактики, техники и процедуры могут использоваться отдельными
атакующими и атаковать нашу сеть и оставаться незамеченными
Необходимо знать каие источники логирования необходимо использовать для того что бы
успешно детектировать события связанные с APT










