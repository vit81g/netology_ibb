Задача systemctl & journalctl
Легенда

На лекции мы рассмотрели работу с systemd и journald. В это ДЗ вам необходимо будет закрепить данные навыки, зарегистрировав предлагаемый вам сервер в качестве сервиса systemd и проанализировав его логи с помощью journalctl.

Примечание для пользователей Mac: данное задание следует выполнять на процессорах с архитектурой Intel. На ARM приложение не будет работать.
Задача

Скачайте:

    Исполняемый файл сервера  https://github.com/netology-code/ibos-homeworks/blob/master/03_nix/assets/server.bin
    Сертификат                https://github.com/netology-code/ibos-homeworks/blob/master/03_nix/assets/certificate.pem
    и приватный ключ          https://github.com/netology-code/ibos-homeworks/blob/master/03_nix/assets/key.pem

Настройте запуск сервера (используйте виртуальную машину с ОС Ubuntu) при старте системы с рабочим каталогом /opt/app (сертификаты должны располагаться в нём же).

С помощью journalctl отследите, лог приложения (не менее 2х минут) и пришлите:

    Скриншот, либо содержимое файла app.service
    Ответы на впоросы:
        На каком IP и порту запускается сервис
        Кто (IP и порт) шлёт запросы на этот сервис и на какой путь
        Какие ответы (формат) получает клиент из п.ii получает в ответ на свои запросы
        Какой ответ (HTTP статус код) получите вы, если пошлёте из браузера запрос на этот же адрес (сертификат самоподписанный, поэтому вам необходимо принять его)

Выполнение
Пошаговое выполнение

    Исполняемый файл сервера поместите в каталог /opt/app (при необходимости создайте его командой sudo mkdir -p /opt/app)
    Установите права на исполнение на файл сервера командой: sudo chmod +x /opt/app/server.bin
    Разместите сертификаты в каталоге /opt/app (необходимо их скопировать в этот каталог)
    Настройте сервис systemd под именем app.service (файл /etc/systemd/system/app.service) таким образом, чтобы:
        сервис запускался при старте системы (после network.target и auditd.service)
        сервис перезапускался при ошибке (on-failure)
        рабочий каталог сервиса был равен /opt/app
    Запустите сервис командой sudo systemctl start app.service
    Удостоверьтесь, что сервис запустился командой sudo systemctl status app.service
    Подождите несколько минут
    Посмотрите журналы сервиса командой sudo journalctl -u app.service
    Включите сервис в "автозагрузку" командой sudo systemctl enable app.service
    Удостоверьтесь, что после перезагрузки ОС сервис автоматически запускается с помощью команды sudo systemctl status app.service

Подсказка (общий вид файла app.service)

[Unit]
Description=...
After=...

[Service]
ExecStart=...

[Install]
WantedBy=...



Решение

1. Скриншот, либо содержимое файла app.service
[Unit]
Description=Start-server.bin             # отвечает за старт сервиса
After=network.target auditd.service      # параметр запуска после старта network.target (старт сети) и auditd.service (старт журналирования)
Restart=on-failure                       # параметр перезагрузки при ошибке

[Service]
WorkingDirectory=/opt/app                # указана рабочая деректория с файлами
ExecStart=/opt/app/server.bin		 # указана рабочая дериктория с файлом для запуска

[Install]
WantedBy=default.target 

2. Ответы на впоросы:
2.1 На каком IP и порту запускается сервис
0.0.0.0:9999
2.2 Кто (IP и порт) шлёт запросы на этот сервис и на какой путь
127.0.0.1:48698
IP - 127.0.0.1
PORT - меняется

2.3 Какие ответы (формат) получает клиент из п.ii получает в ответ на свои запросы
{"ID":"2f16921baec9cc719282","status":"ok"}
вид словаря. Значение ID и статус OK

2.4 Какой ответ (HTTP статус код) получите вы, если пошлёте из браузера запрос на этот же адрес (сертификат самоподписанный, поэтому вам необходимо принять его)
400 Bad Request

