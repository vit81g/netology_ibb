Часть 1. Настройки по умолчанию:

Файл /var/lib/postgresql/data/pg_hba.conf

1. Какие методы аутентификации используются для подключения по TCP/IP с адресов 127.0.0.1/32 и ::1/128?
Ко всем базам (all), для всех пользователей (all), метод - trust (предполагает, что любой подключающийся к серверу авторизован для доступа к базе данных вне зависимости от указанного имени пользователя базы данных (даже если это имя суперпользователя)).

2. Какие методы аутентификации используются для подключения по TCP/IP со всех остальных адресов, кроме указанных в предыдущем пункте по протоколу?
Ко всем базам (all), для всех пользователей (all), для всех адресов (all), метод - md5 (Он предотвращает перехват паролей и предусматривает хранение паролей на сервере в зашифрованном виде, но не защищает в случае похищения хешей паролей с сервера. Кроме того, алгоритм хеширования MD5 в наши дни уже может не защитить от целенаправленных атак).

Настройки ролей, хранящихся в БД:

1. Верно ли утверждение: пароль роли app хранится в виде функция_хеширования password (пароль хранится в поле rolpassword)? Если неверно, то дайте описание алгоритма, который используется для хранения хеша.
Верно. Алгоритм MD5. Он предотвращает перехват паролей и предусматривает хранение паролей на сервере в зашифрованном виде, но не защищает в случае похищения хешей паролей с сервера.

2. Какое значение имеют поля rolsuper, rolcreaterole, rolcreatedb, rolbypassrls с указанием назначения данных столбцов? t будет означать «да», f — «нет».
rolsuper - t. app имеет права суперпользователя;
rolcreaterole - t. app может создавать другие роли;
rolcreatedb - t. app может создавать базы данных;
rolbypassrls - t. app не подчиняется никаким политикам защиты на уровне строк;

Часть 2. Изменение метода аутентификации.

1. Почему значения полей rolcanlogin и rolpassword для роли app не изменились, и вы по-прежнему можете подключиться с помощью psql без указания пароля, хотя в pg_hba.conf для host all all all указано reject?
Потому что сначала обрабатывается local с параметрами all all trust (доступ для всех с локальной машины), host (IPv4) с параметрами all all 127.0.0.1/32 trust (доступ для всех с локальной машины), host (IPv6) с параметрами all all ::1/128 trust (доступ для всех с локальной машины). В файле pg_hba.conf в самом конце имеется запись host all all all reject которая предусматривает аутентификацию пользователей при подключении с других хостов.


Задание «CIS PostgreSQL Benchmarks»

1. Какие методы не рекомендуется использовать для удалённых подключений?
Для удаленного подключения нерекомендуется использовать методы : trust, password, ident. Метод md5, алгоритм хеширования MD5 в наши дни уже может не защитить от целенаправленных атак, но все еще популярен.

2. Какие методы рекомендуется использовать для удалённых подключений?
Рекомендуется использовать метод scram-sha-256 вместо md5.


Часть 2. Проверка ПРД.
Результаты выполнения задания

test=> DELETE FROM records;
ERROR:  permission denied for table records
test=> SELECT * FROM records;
ERROR:  permission denied for table records
test=> 

